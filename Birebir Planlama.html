<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Et√ºt Planlama Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 30px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .input-group {
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            min-height: 44px;
        }
        
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 35px;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 44px;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            font-size: 17px;
            padding: 16px;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }
        
        .clear-btn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .assignments-list {
            margin-top: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .assignments-list h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 17px;
        }
        
        .week-group {
            margin-bottom: 15px;
        }
        
        .week-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .week-count {
            background: rgba(255,255,255,0.3);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .assignment-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .assignment-info {
            margin-bottom: 8px;
        }
        
        .assignment-info strong {
            font-size: 16px;
            color: #333;
        }
        
        .assignment-details {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }
        
        .delete-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            width: 100%;
            font-weight: 600;
        }
        
        .delete-btn:active {
            background: #c53030;
        }
        
        #editModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 20px auto;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f0f0f0;
        }
        
        .close:active {
            background: #e0e0e0;
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .no-slots {
            color: #999;
            font-style: italic;
            padding: 15px;
            text-align: center;
            background: white;
            border-radius: 8px;
        }
        
        .stats {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            text-align: center;
            font-size: 13px;
            color: #2d3748;
            font-weight: 600;
        }
        
        .date-display {
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .week-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .week-option {
            padding: 10px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            transition: all 0.2s;
        }
        
        .week-option:active {
            transform: scale(0.95);
        }
        
        .week-option.selected {
            background: #667eea;
            color: white;
        }
        
        .info-text {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Et√ºt Planlama Sistemi</h1>
        
        <!-- Hafta Se√ßimi -->
        <div class="input-group">
            <label>üìÖ Hafta Se√ßin:</label>
            <div class="week-selector" id="weekSelector"></div>
        </div>
        
        <!-- √ñƒüretmen Se√ßimi -->
        <div class="input-group">
            <label>üë®‚Äçüè´ √ñƒüretmen Se√ßin:</label>
            <select id="teacherSelect" onchange="updateTimeSlots()">
                <option value="">-- √ñƒüretmen Se√ßin --</option>
            </select>
        </div>
        
        <!-- G√ºn ve Saat Se√ßimi -->
        <div class="input-group">
            <label>‚è∞ Bo≈ü Et√ºt Saati:</label>
            <select id="timeSlotSelect" disabled>
                <option value="">-- √ñnce √∂ƒüretmen se√ßin --</option>
            </select>
            <div id="dateDisplay" class="date-display"></div>
        </div>
        
        <!-- √ñƒürenci Adƒ± -->
        <div class="input-group">
            <label>üë§ √ñƒürenci Adƒ±:</label>
            <input type="text" id="studentName" placeholder="√ñƒürenci adƒ±nƒ± girin..." disabled>
        </div>
        
        <button onclick="addAssignment()" class="add-btn">‚ûï Et√ºt Kaydƒ± Ekle</button>
        
        <!-- ƒ∞statistikler -->
        <div class="stats" id="stats"></div>
        
        <!-- Kayƒ±tlƒ± Et√ºtler Listesi -->
        <div class="assignments-list">
            <h2>üìã Kayƒ±tlƒ± Et√ºtler</h2>
            <div id="assignmentsList"></div>
        </div>
        
        <!-- Butonlar -->
        <button onclick="exportData()" class="export-btn">üì§ Verileri Dƒ±≈üa Aktar</button>
        <button onclick="clearAll()" class="clear-btn">üóëÔ∏è T√ºm√ºn√º Temizle</button>
        <button onclick="openEditModal()" class="edit-btn">‚öôÔ∏è Et√ºt Saatlerini D√ºzenle</button>
    </div>
    
    <!-- D√ºzenleme Modalƒ± -->
    <div id="editModal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>‚öôÔ∏è Et√ºt Saatlerini D√ºzenle</h2>
            <p class="info-text">
                Her satƒ±ra bir et√ºt saati girin.<br>
                Format: <b>√ñƒüretmen|G√ºn|Ba≈ülangƒ±√ß-Biti≈ü</b><br>
                √ñrnek: Ali|Pazartesi|13:20-13:40
            </p>
            <textarea id="scheduleEditor"></textarea>
            <button onclick="saveSchedule()">üíæ Deƒüi≈üiklikleri Kaydet</button>
        </div>
    </div>

    <script>
        // Ba≈ülangƒ±√ß verileri
        let scheduleData = [
            {teacher: "Ali", day: "Pazartesi", time: "13:20-13:40"},
            {teacher: "Ali", day: "Pazartesi", time: "13:40-14:00"},
            {teacher: "Ali", day: "Salƒ±", time: "16:30-16:50"},
            {teacher: "Ali", day: "√áar≈üamba", time: "17:00-17:20"},
            {teacher: "Ali", day: "√áar≈üamba", time: "17:20-17:40"},
            {teacher: "ƒ∞brahim", day: "Pazartesi", time: "13:20-13:40"},
            {teacher: "ƒ∞brahim", day: "√áar≈üamba", time: "17:00-17:20"},
            {teacher: "ƒ∞brahim", day: "√áar≈üamba", time: "17:20-17:40"},
            {teacher: "ƒ∞brahim", day: "Cuma", time: "17:00-17:20"},
            {teacher: "ƒ∞brahim", day: "Cuma", time: "17:20-17:40"},
            {teacher: "Pƒ±nar", day: "Pazartesi", time: "13:20-13:40"},
            {teacher: "Pƒ±nar", day: "Pazartesi", time: "13:40-14:00"},
            {teacher: "Pƒ±nar", day: "Salƒ±", time: "16:30-16:50"},
            {teacher: "Pƒ±nar", day: "√áar≈üamba", time: "17:00-17:20"},
            {teacher: "Pƒ±nar", day: "√áar≈üamba", time: "17:20-17:40"},
            {teacher: "Pƒ±nar", day: "Cuma", time: "17:00-17:20"},
            {teacher: "Pƒ±nar", day: "Cuma", time: "17:20-17:40"}
        ];
        
        let assignments = [];
        let selectedWeekOffset = 0;
        const maxWeeks = 4;
        
        // T√ºrk√ße g√ºn isimleri (Pazartesi = 0, Pazar = 6)
        const dayNames = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        
        // Bug√ºn√ºn i√ßinde bulunduƒüu haftanƒ±n Pazartesi'sini bul
        function getThisWeekMonday() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dayOfWeek = today.getDay(); // 0=Pazar, 1=Pazartesi, ...
            const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const monday = new Date(today);
            monday.setDate(today.getDate() + daysToMonday);
            return monday;
        }
        
        // Belirli bir hafta offset'i i√ßin Pazartesi'yi al
        function getMondayForWeek(weekOffset) {
            const thisMonday = getThisWeekMonday();
            const targetMonday = new Date(thisMonday);
            targetMonday.setDate(thisMonday.getDate() + (weekOffset * 7));
            return targetMonday;
        }
        
        // Belirli bir haftanƒ±n Pazar'ƒ±nƒ± al
        function getSundayForWeek(weekOffset) {
            const monday = getMondayForWeek(weekOffset);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            return sunday;
        }
        
        // Belirli bir g√ºn√ºn tarihini hesapla
        function getDateForDay(dayName, weekOffset) {
            const monday = getMondayForWeek(weekOffset);
            const dayIndex = dayNames.indexOf(dayName);
            if (dayIndex === -1) return null;
            
            const date = new Date(monday);
            date.setDate(monday.getDate() + dayIndex);
            return date;
        }
        
        // Tarih formatla
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${day}.${month}.${date.getFullYear()}`;
        }
        
        // Tarih string'ine √ßevir (YYYY-MM-DD)
        function dateToString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // String'i tarihe √ßevir
        function stringToDate(str) {
            return new Date(str + 'T00:00:00');
        }
        
        // Bir tarihin hangi haftaya ait olduƒüunu bul (hafta etiketi i√ßin)
        function getWeekLabelForDate(date) {
            const thisMonday = getThisWeekMonday();
            
            // Tarihin Pazartesi'sini bul
            const dateCopy = new Date(date);
            dateCopy.setHours(0, 0, 0, 0);
            const dayOfWeek = dateCopy.getDay();
            const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const dateMonday = new Date(dateCopy);
            dateMonday.setDate(dateCopy.getDate() + daysToMonday);
            
            // Hafta farkƒ±nƒ± hesapla
            const diffTime = dateMonday.getTime() - thisMonday.getTime();
            const diffWeeks = Math.round(diffTime / (7 * 24 * 60 * 60 * 1000));
            
            if (diffWeeks === 0) return 'Bu Hafta';
            if (diffWeeks === 1) return 'Gelecek Hafta';
            if (diffWeeks > 1) return `${diffWeeks} Hafta Sonra`;
            return 'Ge√ßmi≈ü';
        }
        
        // Sayfa y√ºklendiƒüinde
        window.onload = function() {
            loadData();
            createWeekSelector();
            updateTeacherList();
            displayAssignments();
            updateStats();
        }
        
        // Verileri y√ºkle
        function loadData() {
            try {
                const savedSchedule = localStorage.getItem('scheduleData');
                if (savedSchedule) {
                    scheduleData = JSON.parse(savedSchedule);
                }
            } catch (e) {
                console.error('Schedule load error:', e);
            }
            
            try {
                const savedAssignments = localStorage.getItem('assignments');
                if (savedAssignments) {
                    assignments = JSON.parse(savedAssignments);
                }
            } catch (e) {
                console.error('Assignments load error:', e);
            }
        }
        
        // Verileri kaydet
        function saveToStorage() {
            try {
                localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
                localStorage.setItem('assignments', JSON.stringify(assignments));
                return true;
            } catch (e) {
                console.error('Storage save error:', e);
                return false;
            }
        }
        
        // Hafta se√ßiciyi olu≈ütur
        function createWeekSelector() {
            const selector = document.getElementById('weekSelector');
            selector.innerHTML = '';
            
            for (let i = 0; i < maxWeeks; i++) {
                const option = document.createElement('div');
                option.className = 'week-option' + (i === selectedWeekOffset ? ' selected' : '');
                
                const monday = getMondayForWeek(i);
                const sunday = getSundayForWeek(i);
                
                const label = i === 0 ? 'Bu Hafta' : 
                             i === 1 ? 'Gelecek Hafta' : 
                             `${i} Hafta Sonra`;
                
                option.innerHTML = `${label}<br><small>${formatDate(monday)} - ${formatDate(sunday)}</small>`;
                option.onclick = () => selectWeek(i);
                selector.appendChild(option);
            }
        }
        
        // Hafta se√ß
        function selectWeek(weekOffset) {
            selectedWeekOffset = weekOffset;
            createWeekSelector();
            updateTimeSlots();
        }
        
        // √ñƒüretmen listesini g√ºncelle
        function updateTeacherList() {
            const teacherSelect = document.getElementById('teacherSelect');
            const teachers = [...new Set(scheduleData.map(s => s.teacher))].sort();
            
            teacherSelect.innerHTML = '<option value="">-- √ñƒüretmen Se√ßin --</option>';
            teachers.forEach(teacher => {
                teacherSelect.innerHTML += `<option value="${teacher}">${teacher}</option>`;
            });
        }
        
        // Se√ßilen √∂ƒüretmenin bo≈ü saatlerini g√ºncelle
        function updateTimeSlots() {
            const teacher = document.getElementById('teacherSelect').value;
            const timeSlotSelect = document.getElementById('timeSlotSelect');
            const studentInput = document.getElementById('studentName');
            const dateDisplay = document.getElementById('dateDisplay');
            
            dateDisplay.innerHTML = '';
            
            if (!teacher) {
                timeSlotSelect.disabled = true;
                studentInput.disabled = true;
                timeSlotSelect.innerHTML = '<option value="">-- √ñnce √∂ƒüretmen se√ßin --</option>';
                return;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Bu √∂ƒüretmenin t√ºm saatlerini al
            const teacherSlots = scheduleData.filter(s => s.teacher === teacher);
            
            // Bu √∂ƒüretmenin dolu saatlerini bul (tarih + saat bazƒ±nda)
            const busySlots = assignments
                .filter(a => a.teacher === teacher)
                .map(a => `${a.date}|${a.time}`);
            
            // Bo≈ü saatleri filtrele
            const availableSlots = teacherSlots.filter(slot => {
                const date = getDateForDay(slot.day, selectedWeekOffset);
                if (!date) return false;
                
                const dateKey = dateToString(date);
                
                // Eƒüer bu hafta se√ßiliyse ve tarih ge√ßmi≈üte ise g√∂sterme
                if (selectedWeekOffset === 0 && date < today) {
                    return false;
                }
                
                // Dolu saatleri √ßƒ±kar (tarih + saat kontrol√º)
                return !busySlots.includes(`${dateKey}|${slot.time}`);
            });
            
            timeSlotSelect.disabled = false;
            studentInput.disabled = false;
            
            if (availableSlots.length === 0) {
                timeSlotSelect.innerHTML = '<option value="">Bu haftada bo≈ü et√ºt saati yok</option>';
            } else {
                timeSlotSelect.innerHTML = '<option value="">-- Saat Se√ßin --</option>';
                availableSlots.forEach(slot => {
                    const date = getDateForDay(slot.day, selectedWeekOffset);
                    const dateStr = formatDate(date);
                    const optionText = `${slot.day} (${dateStr}) - ${slot.time}`;
                    const slotData = {...slot, date: dateToString(date)};
                    const optionValue = JSON.stringify(slotData);
                    timeSlotSelect.innerHTML += `<option value='${optionValue}'>${optionText}</option>`;
                });
            }
            
            // Saat se√ßildiƒüinde tarihi g√∂ster
            timeSlotSelect.onchange = function() {
                if (this.value) {
                    const slot = JSON.parse(this.value);
                    dateDisplay.innerHTML = `üìÖ ${formatDate(stringToDate(slot.date))}`;
                } else {
                    dateDisplay.innerHTML = '';
                }
            };
        }
        
        // Yeni kayƒ±t ekle
        function addAssignment() {
            try {
                const teacher = document.getElementById('teacherSelect').value;
                const slotSelect = document.getElementById('timeSlotSelect');
                const studentName = document.getElementById('studentName').value.trim();
                
                if (!teacher) {
                    alert('‚ùå L√ºtfen bir √∂ƒüretmen se√ßin!');
                    return false;
                }
                
                if (!slotSelect.value || slotSelect.value === '' || slotSelect.value === '{}') {
                    alert('‚ùå L√ºtfen bir et√ºt saati se√ßin!');
                    return false;
                }
                
                if (!studentName || studentName.length === 0) {
                    alert('‚ùå L√ºtfen √∂ƒürenci adƒ±nƒ± girin!');
                    return false;
                }
                
                let slot;
                try {
                    slot = JSON.parse(slotSelect.value);
                } catch (e) {
                    alert('‚ùå Saat verisi okunamadƒ±! L√ºtfen tekrar deneyin.');
                    console.error('Parse error:', e);
                    return false;
                }
                
                if (!slot || !slot.teacher || !slot.day || !slot.time || !slot.date) {
                    alert('‚ùå Saat bilgisi eksik! L√ºtfen tekrar se√ßin.');
                    console.error('Invalid slot:', slot);
                    return false;
                }
                
                // √áift kayƒ±t kontrol√º
                const isDuplicate = assignments.some(a => 
                    a.teacher === slot.teacher && 
                    a.date === slot.date && 
                    a.time === slot.time
                );
                
                if (isDuplicate) {
                    alert('‚ùå Bu saat zaten dolu! L√ºtfen ba≈üka bir saat se√ßin.');
                    return false;
                }
                
                const newAssignment = {
                    teacher: slot.teacher,
                    day: slot.day,
                    time: slot.time,
                    date: slot.date,
                    student: studentName,
                    id: new Date().getTime() + Math.random()
                };
                
                assignments.push(newAssignment);
                
                try {
                    saveToStorage();
                } catch (e) {
                    alert('‚ö†Ô∏è Kayƒ±t yerel depolamaya yazƒ±lamadƒ±, ancak oturum boyunca √ßalƒ±≈üacak.');
                    console.error('Storage error:', e);
                }
                
                // Formu temizle
                document.getElementById('teacherSelect').value = '';
                document.getElementById('timeSlotSelect').innerHTML = '<option value="">-- √ñnce √∂ƒüretmen se√ßin --</option>';
                document.getElementById('timeSlotSelect').disabled = true;
                document.getElementById('studentName').value = '';
                document.getElementById('studentName').disabled = true;
                document.getElementById('dateDisplay').innerHTML = '';
                
                displayAssignments();
                updateStats();
                
                alert('‚úÖ Et√ºt kaydƒ± ba≈üarƒ±yla eklendi!\n\nüë§ ' + studentName + '\nüë®‚Äçüè´ ' + slot.teacher + '\nüìÖ ' + slot.day + ' (' + formatDate(stringToDate(slot.date)) + ')\n‚è∞ ' + slot.time);
                
                return true;
            } catch (error) {
                alert('‚ùå Kayƒ±t eklenirken hata olu≈ütu!\n\nHata: ' + error.message);
                console.error('addAssignment error:', error);
                return false;
            }
        }
        
        // Kayƒ±tlarƒ± g√∂ster
        function displayAssignments() {
            const list = document.getElementById('assignmentsList');
            
            if (assignments.length === 0) {
                list.innerHTML = '<div class="no-slots">Hen√ºz kayƒ±t yok</div>';
                return;
            }
            
            // Haftaya g√∂re grupla
            const byWeek = {};
            
            assignments.forEach(a => {
                const date = stringToDate(a.date);
                
                // Bu tarihin Pazartesi'sini bul
                const dayOfWeek = date.getDay();
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                const monday = new Date(date);
                monday.setDate(date.getDate() + daysToMonday);
                monday.setHours(0, 0, 0, 0);
                
                const weekKey = dateToString(monday);
                
                if (!byWeek[weekKey]) {
                    const sunday = new Date(monday);
                    sunday.setDate(monday.getDate() + 6);
                    byWeek[weekKey] = {
                        monday: monday,
                        sunday: sunday,
                        assignments: []
                    };
                }
                byWeek[weekKey].assignments.push(a);
            });
            
            // Haftalara g√∂re sƒ±rala
            const sortedWeeks = Object.keys(byWeek).sort();
            
            list.innerHTML = '';
            sortedWeeks.forEach(weekKey => {
                const week = byWeek[weekKey];
                const weekGroup = document.createElement('div');
                weekGroup.className = 'week-group';
                
                // Hafta etiketi
                const weekLabel = getWeekLabelForDate(week.monday);
                
                weekGroup.innerHTML = `
                    <div class="week-header">
                        <span>${weekLabel} (${formatDate(week.monday)} - ${formatDate(week.sunday)})</span>
                        <span class="week-count">${week.assignments.length} et√ºt</span>
                    </div>
                `;
                
                // Tarihe ve saate g√∂re sƒ±rala
                const sorted = week.assignments.sort((a, b) => {
                    const dateDiff = a.date.localeCompare(b.date);
                    if (dateDiff !== 0) return dateDiff;
                    return a.time.localeCompare(b.time);
                });
                
                sorted.forEach(assignment => {
                    const item = document.createElement('div');
                    item.className = 'assignment-item';
                    const assignDate = stringToDate(assignment.date);
                    item.innerHTML = `
                        <div class="assignment-info">
                            <strong>üë§ ${assignment.student}</strong>
                            <div class="assignment-details">
                                üë®‚Äçüè´ ${assignment.teacher}<br>
                                üìÖ ${assignment.day}, ${formatDate(assignDate)}<br>
                                ‚è∞ ${assignment.time}
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deleteAssignment(${assignment.id})">üóëÔ∏è Sil</button>
                    `;
                    weekGroup.appendChild(item);
                });
                
                list.appendChild(weekGroup);
            });
        }
        
        // Kayƒ±t sil
        function deleteAssignment(id) {
            if (confirm('Bu kaydƒ± silmek istediƒüinize emin misiniz?')) {
                assignments = assignments.filter(a => a.id !== id);
                saveToStorage();
                displayAssignments();
                updateStats();
                
                const teacher = document.getElementById('teacherSelect').value;
                if (teacher) {
                    updateTimeSlots();
                }
            }
        }
        
        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            const stats = document.getElementById('stats');
            const totalSlots = scheduleData.length * maxWeeks;
            const usedSlots = assignments.length;
            
            stats.innerHTML = `
                üìä Toplam: ${usedSlots} kayƒ±t | 
                üéØ ${maxWeeks} haftalƒ±k planlama
            `;
        }
        
        // Verileri dƒ±≈üa aktar (UTF-8 BOM ile)
        function exportData() {
            if (assignments.length === 0) {
                alert('‚ùå Dƒ±≈üa aktarƒ±lacak kayƒ±t yok!');
                return;
            }
            
            let exportText = "üìä ET√úT PROGRAMI\n";
            exportText += "=".repeat(50) + "\n";
            exportText += `Tarih: ${formatDate(new Date())}\n`;
            exportText += "=".repeat(50) + "\n\n";
            
            // Haftaya g√∂re grupla
            const byWeek = {};
            assignments.forEach(a => {
                const date = stringToDate(a.date);
                const dayOfWeek = date.getDay();
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                const monday = new Date(date);
                monday.setDate(date.getDate() + daysToMonday);
                monday.setHours(0, 0, 0, 0);
                
                const weekKey = dateToString(monday);
                if (!byWeek[weekKey]) {
                    const sunday = new Date(monday);
                    sunday.setDate(monday.getDate() + 6);
                    byWeek[weekKey] = {
                        monday: monday,
                        sunday: sunday,
                        assignments: []
                    };
                }
                byWeek[weekKey].assignments.push(a);
            });
            
            // Haftalara g√∂re sƒ±rala
            const sortedWeeks = Object.keys(byWeek).sort();
            
            sortedWeeks.forEach(weekKey => {
                const week = byWeek[weekKey];
                const weekLabel = getWeekLabelForDate(week.monday);
                
                exportText += `\nüìÖ ${weekLabel.toUpperCase()}: ${formatDate(week.monday)} - ${formatDate(week.sunday)}\n`;
                exportText += "=".repeat(50) + "\n";
                
                // √ñƒüretmene g√∂re grupla
                const byTeacher = {};
                week.assignments.forEach(a => {
                    if (!byTeacher[a.teacher]) {
                        byTeacher[a.teacher] = [];
                    }
                    byTeacher[a.teacher].push(a);
                });
                
                Object.keys(byTeacher).sort().forEach(teacher => {
                    exportText += `\nüë®‚Äçüè´ ${teacher.toUpperCase()}\n`;
                    exportText += "-".repeat(40) + "\n";
                    
                    byTeacher[teacher].sort((a, b) => {
                        const dateDiff = a.date.localeCompare(b.date);
                        if (dateDiff !== 0) return dateDiff;
                        return a.time.localeCompare(b.time);
                    }).forEach(a => {
                        const assignDate = stringToDate(a.date);
                        exportText += `üìÖ ${a.day} (${formatDate(assignDate)}) | ‚è∞ ${a.time} | üë§ ${a.student}\n`;
                    });
                });
            });
            
            // ƒ∞statistikler
            exportText += "\n" + "=".repeat(50) + "\n";
            exportText += "üìä ƒ∞STATƒ∞STƒ∞KLER\n";
            exportText += "-".repeat(40) + "\n";
            exportText += `Toplam Kayƒ±t: ${assignments.length}\n`;
            
            // √ñƒüretmene g√∂re sayƒ±lar
            const teacherCounts = {};
            assignments.forEach(a => {
                teacherCounts[a.teacher] = (teacherCounts[a.teacher] || 0) + 1;
            });
            
            exportText += "\n√ñƒüretmenlere G√∂re:\n";
            Object.keys(teacherCounts).sort().forEach(teacher => {
                exportText += `  ${teacher}: ${teacherCounts[teacher]} et√ºt\n`;
            });
            
            // UTF-8 BOM ekle (T√ºrk√ße karakterler i√ßin)
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + exportText], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `etut_programi_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            // Panoya kopyala
            navigator.clipboard.writeText(exportText).then(() => {
                alert('‚úÖ Veriler hem indirildi hem de panoya kopyalandƒ±!\n\nüí° Not: ƒ∞ndirilen TXT dosyasƒ± T√ºrk√ße karakterleri d√ºzg√ºn g√∂sterecektir.');
            }).catch(() => {
                alert('‚úÖ Veriler indirildi!\n\nüí° Not: T√ºrk√ße karakterler d√ºzg√ºn g√∂r√ºnecektir.');
            });
        }
        
        // T√ºm√ºn√º temizle
        function clearAll() {
            if (confirm('‚ö†Ô∏è T√úM KAYITLARI Sƒ∞LMEK ƒ∞STEDƒ∞ƒûƒ∞Nƒ∞ZE EMƒ∞N Mƒ∞Sƒ∞Nƒ∞Z?\n\nBu i≈ülem geri alƒ±namaz!')) {
                assignments = [];
                saveToStorage();
                displayAssignments();
                updateStats();
                
                const teacher = document.getElementById('teacherSelect').value;
                if (teacher) {
                    updateTimeSlots();
                }
                
                alert('‚úÖ T√ºm kayƒ±tlar silindi!');
            }
        }
        
        // D√ºzenleme modalƒ±nƒ± a√ß
        function openEditModal() {
            const modal = document.getElementById('editModal');
            const editor = document.getElementById('scheduleEditor');
            
            // Mevcut programƒ± edit√∂re yaz
            let text = '';
            scheduleData.forEach(slot => {
                text += `${slot.teacher}|${slot.day}|${slot.time}\n`;
            });
            
            editor.value = text;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Modalƒ± kapat
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Programƒ± kaydet
        function saveSchedule() {
            const editor = document.getElementById('scheduleEditor');
            const lines = editor.value.trim().split('\n');
            
            const newSchedule = [];
            
            lines.forEach(line => {
                const parts = line.split('|');
                if (parts.length === 3) {
                    const teacher = parts[0].trim();
                    const day = parts[1].trim();
                    const time = parts[2].trim();
                    
                    if (teacher && day && time) {
                        newSchedule.push({ teacher, day, time });
                    }
                }
            });
            
            if (newSchedule.length === 0) {
                alert('‚ùå Ge√ßerli veri girilmedi!');
                return;
            }
            
            // Mevcut atamalarƒ± kontrol et
            const conflictingAssignments = assignments.filter(a => {
                return !newSchedule.some(s => 
                    s.teacher === a.teacher && 
                    s.day === a.day && 
                    s.time === a.time
                );
            });
            
            if (conflictingAssignments.length > 0) {
                const confirmMsg = `‚ö†Ô∏è Dƒ∞KKAT: ${conflictingAssignments.length} adet mevcut kayƒ±t, yeni programda kar≈üƒ±lƒ±ƒüƒ± olmayan saatlere ait.\n\nBu kayƒ±tlar silinecek. Devam etmek istiyor musunuz?`;
                
                if (!confirm(confirmMsg)) {
                    return;
                }
                
                // √áakƒ±≈üan kayƒ±tlarƒ± sil
                assignments = assignments.filter(a => {
                    return newSchedule.some(s => 
                        s.teacher === a.teacher && 
                        s.day === a.day && 
                        s.time === a.time
                    );
                });
            }
            
            scheduleData = newSchedule;
            saveToStorage();
            updateTeacherList();
            displayAssignments();
            updateStats();
            closeEditModal();
            
            alert('‚úÖ Et√ºt saatleri g√ºncellendi!');
        }
        
        // Modal dƒ±≈üƒ±na tƒ±klanƒ±nca kapat
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>